(function(){"use strict";function m(e){const t=atob(e),a=t.length,n=new Uint8Array(a);for(let o=0;o<a;o++)n[o]=t.charCodeAt(o);return n}function g(e){let a="";for(let n=0;n<e.length;n+=32768){const o=e.subarray(n,n+32768);a+=String.fromCharCode.apply(null,o)}return btoa(a)}const{Streamlit:s}=window.Streamlit,u=window.FFmpegWASM||window.FFmpeg;if(!u){const e="FFmpeg library not loaded from CDN. Check script tags in index.html.";console.error(e),s.setComponentValue({error:e});const t=document.getElementById("root");throw t&&(t.innerHTML=`<div style="color: red;">${e}</div>`),new Error(e)}const{FFmpeg:y}=u;let l=null;async function p(){const e=document.getElementById("status");return l||(e.textContent="Status: Loading ffmpeg-core.js",l=new y,l.on("log",({message:t})=>{console.log(t),e&&(e.textContent=`Log: ${t}`)}),l.on("progress",({progress:t})=>{e&&(e.textContent=`Status: Processing ${Math.round(t*100)}%`)}),await l.load()),l}async function f(e,t,a="input.mp4",n=100){const o=await p(),r=a;let i=null,d=null;try{const c=e.length*.75/1048576;if(c>n)throw new Error(`File too large: ${c.toFixed(1)}MB. Limit is ${n}MB.`);d=m(e),await o.writeFile(r,d),await o.exec(t),i=t[t.length-1];const F=await o.readFile(i);return g(new Uint8Array(F))}finally{d=null;try{await o.deleteFile(r)}catch{}try{i&&await o.deleteFile(i)}catch{}}}function w(e){const t=e.detail.args,a=document.getElementById("root");a.innerHTML===""&&(a.innerHTML='<p id="status-container">Status: <span id="status">Idle</span></p>');const n=document.getElementById("status"),o=document.getElementById("status-container");let r=document.getElementById("loader");r||(r=document.createElement("div"),r.id="loader",r.className="loader",r.style.display="none",o.appendChild(r)),t.command&&t.data&&(n.textContent="Processing...",r.style.display="inline-block",f(t.data,t.command,t.filename,t.max_size_mb).then(i=>{s.setComponentValue({output:i}),n.textContent="Done!",r.style.display="none"}).catch(i=>{console.error(i),s.setComponentValue({error:String(i)}),n.textContent=`Error - ${i}`,r.style.display="none"}))}s.events.addEventListener(s.RENDER_EVENT,w),s.setFrameHeight(100)})();
