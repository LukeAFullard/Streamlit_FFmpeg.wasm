(function(){"use strict";const{Streamlit:i}=window.Streamlit,u=window.FFmpegWASM||window.FFmpeg;if(!u){const e="FFmpeg library not loaded from CDN. Check script tags in index.html.";console.error(e),i.setComponentValue({error:e});const t=document.getElementById("root");throw t&&(t.innerHTML=`<div style="color: red;">${e}</div>`),new Error(e)}const{FFmpeg:d}=u;let a=null;function m(e){const t=atob(e),r=t.length,n=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=t.charCodeAt(o);return n}function g(e){let r="";for(let n=0;n<e.length;n+=32768){const o=e.subarray(n,n+32768);r+=String.fromCharCode.apply(null,o)}return btoa(r)}async function f(){const e=document.getElementById("status");return a||(e.textContent="Status: Loading ffmpeg-core.js",a=new d,a.on("log",({message:t})=>{console.log(t),e&&(e.textContent=`Log: ${t}`)}),a.on("progress",({progress:t})=>{e&&(e.textContent=`Status: Processing ${Math.round(t*100)}%`)}),await a.load()),a}async function p(e,t,r=100){const n=await f(),o="input.mp4";let s=null,c=null;try{const l=e.length*.75/1048576;if(l>r)throw new Error(`File too large: ${l.toFixed(1)}MB. Limit is ${r}MB.`);c=m(e),await n.writeFile(o,c),await n.exec(t),s=t[t.length-1];const F=await n.readFile(s);return g(new Uint8Array(F))}finally{c=null;try{await n.deleteFile(o)}catch{}try{s&&await n.deleteFile(s)}catch{}}}function w(e){const t=e.detail.args,r=document.getElementById("root");r.innerHTML===""&&(r.innerHTML='<p id="status">Status: Idle</p>');const n=document.getElementById("status");t.command&&t.data&&(n.textContent="Status: Processing...",p(t.data,t.command,t.max_size_mb).then(o=>{i.setComponentValue({output:o}),n.textContent="Status: Done!"}).catch(o=>{console.error(o),i.setComponentValue({error:String(o)}),n.textContent=`Status: Error - ${o}`}))}i.events.addEventListener(i.RENDER_EVENT,w),i.setFrameHeight(100)})();
