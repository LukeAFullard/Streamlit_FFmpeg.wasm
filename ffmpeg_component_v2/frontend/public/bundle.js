(function(){"use strict";function u(e){const t=atob(e),r=t.length,n=new Uint8Array(r);for(let a=0;a<r;a++)n[a]=t.charCodeAt(a);return n}function m(e){let r="";for(let n=0;n<e.length;n+=32768){const a=e.subarray(n,n+32768);r+=String.fromCharCode.apply(null,a)}return btoa(r)}const{Streamlit:s}=window.Streamlit,d=window.FFmpegWASM||window.FFmpeg;if(!d){const e="FFmpeg library not loaded from CDN. Check script tags in index.html.";console.error(e),s.setComponentValue({error:e});const t=document.getElementById("root");throw t&&(t.innerHTML=`<div style="color: red;">${e}</div>`),new Error(e)}const{FFmpeg:g}=d;let l=null;async function y(){const e=document.getElementById("status");return l||(e.textContent="Status: Loading ffmpeg-core.js",l=new g,l.on("log",({message:t})=>{console.log(t),e&&(e.textContent=`Log: ${t}`)}),l.on("progress",({progress:t})=>{e&&(e.textContent=`Status: Processing ${Math.round(t*100)}%`)}),await l.load()),l}async function p(e,t,r=100){const n=await y(),a="input.mp4";let o=null,i=null;try{const c=e.length*.75/1048576;if(c>r)throw new Error(`File too large: ${c.toFixed(1)}MB. Limit is ${r}MB.`);i=u(e),await n.writeFile(a,i),await n.exec(t),o=t[t.length-1];const w=await n.readFile(o);return m(new Uint8Array(w))}finally{i=null;try{await n.deleteFile(a)}catch{}try{o&&await n.deleteFile(o)}catch{}}}function f(e){const t=e.detail.args,r=document.getElementById("root");r.innerHTML===""&&(r.innerHTML='<p id="status-container">Status: <span id="status">Idle</span></p>');const n=document.getElementById("status"),a=document.getElementById("status-container");let o=document.getElementById("loader");o||(o=document.createElement("div"),o.id="loader",o.className="loader",o.style.display="none",a.appendChild(o)),t.command&&t.data&&(n.textContent="Processing...",o.style.display="inline-block",p(t.data,t.command,t.max_size_mb).then(i=>{s.setComponentValue({output:i}),n.textContent="Done!",o.style.display="none"}).catch(i=>{console.error(i),s.setComponentValue({error:String(i)}),n.textContent=`Error - ${i}`,o.style.display="none"}))}s.events.addEventListener(s.RENDER_EVENT,f),s.setFrameHeight(100)})();
