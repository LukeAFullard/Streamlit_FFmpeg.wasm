(function(){"use strict";function g(e){const t=atob(e),a=t.length,n=new Uint8Array(a);for(let o=0;o<a;o++)n[o]=t.charCodeAt(o);return n}function f(e){let a="";for(let n=0;n<e.length;n+=32768){const o=e.subarray(n,n+32768);a+=String.fromCharCode.apply(null,o)}return btoa(a)}const{Streamlit:s}=window.Streamlit,m=window.FFmpegWASM||window.FFmpeg;let l=null;m||(l="FFmpeg library not loaded from CDN. Check script tags in index.html.",console.error(l));const{FFmpeg:p}=m||{};let c=null;async function y(){if(l)throw new Error(l);const e=document.getElementById("status");return c||(e.textContent="Status: Loading ffmpeg-core.js",c=new p,c.on("log",({message:t})=>{console.log(t),e&&(e.textContent=`Log: ${t}`)}),c.on("progress",({progress:t})=>{e&&(e.textContent=`Status: Processing ${Math.round(t*100)}%`)}),await c.load()),c}async function w(e,t,a="input.mp4",n=100){const o=await y(),r=a;let i=null,u=null;try{const d=e.length*.75/1048576;if(d>n)throw new Error(`File too large: ${d.toFixed(1)}MB. Limit is ${n}MB.`);u=g(e),await o.writeFile(r,u),await o.exec(t),i=t[t.length-1];const E=await o.readFile(i);return f(new Uint8Array(E))}finally{u=null;try{await o.deleteFile(r)}catch{}try{i&&await o.deleteFile(i)}catch{}}}function C(e){const t=e.detail.args,a=document.getElementById("root");a.innerHTML===""&&(a.innerHTML='<p id="status-container">Status: <span id="status">Idle</span></p>');const n=document.getElementById("status"),o=document.getElementById("status-container");if(l){n.textContent=`Error - ${l}`,s.setComponentValue({error:l});return}let r=document.getElementById("loader");r||(r=document.createElement("div"),r.id="loader",r.className="loader",r.style.display="none",o.appendChild(r)),t.command&&t.data&&(n.textContent="Processing...",r.style.display="inline-block",w(t.data,t.command,t.filename,t.max_size_mb).then(i=>{s.setComponentValue({output:i}),n.textContent="Done!",r.style.display="none"}).catch(i=>{console.error(i),s.setComponentValue({error:String(i)}),n.textContent=`Error - ${i}`,r.style.display="none"}))}s.events.addEventListener(s.RENDER_EVENT,C),s.setFrameHeight(100)})();
